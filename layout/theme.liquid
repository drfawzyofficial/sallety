{%- liquid
  assign rtl_langs = settings.rtl_languages | default: 'ar,he,fa,ur' | split: ','
  assign current_lang = request.locale.iso_code | slice: 0, 2 | downcase
  assign is_rtl_lang = false
  for lang in rtl_langs
    assign lang_trimmed = lang | strip | downcase
    if current_lang == lang_trimmed
      assign is_rtl_lang = true
      break
    endif
  endfor
  assign use_rtl = false
  if settings.enable_rtl and is_rtl_lang
    assign use_rtl = true
  endif
-%}
<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}" dir="{% if use_rtl %}rtl{% else %}ltr{% endif %}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="theme-color" content="{{ settings.color_schemes['scheme-1'].settings.button }}">

    {%- liquid
      assign formatted_initial_value = localization.country.currency.iso_code
    -%}

    <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>

    {%- if settings.font_source == 'google' -%}
      {%- comment -%} Google Fonts Preconnect {%- endcomment -%}
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

      {%- liquid
        assign heading_font = settings.google_font_heading | default: 'Tajawal'
        assign body_font = settings.google_font_body | default: 'Tajawal'
        assign heading_weight = settings.google_font_heading_weight | default: '700'
        assign body_weight = settings.google_font_body_weight | default: '400'

        assign fonts_to_load = heading_font
        if heading_font != body_font
          assign fonts_to_load = heading_font | append: '&family=' | append: body_font
        endif

        assign all_weights = '400;500;700;800'
      -%}

      <link
        href="https://fonts.googleapis.com/css2?family={{ heading_font | replace: ' ', '+' }}:wght@{{ all_weights }}{% if heading_font != body_font %}&family={{ body_font | replace: ' ', '+' }}:wght@{{ all_weights }}{% endif %}&display=swap"
        rel="stylesheet"
      >
    {%- else -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endif -%}

    {%- if settings.favicon != blank -%}
      <link rel="icon" type="image/png" href="{{ settings.favicon | image_url: width: 32, height: 32 }}">
    {%- endif -%}

    <title>
      {{ page_title }}
      {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
      {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
      {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
    </title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    {% render 'meta-tags' %}

    {{ content_for_header }}

    {%- liquid
      if settings.font_source == 'shopify'
        assign body_font_bold = settings.body_font | font_modify: 'weight', 'bold'
        assign body_font_italic = settings.body_font | font_modify: 'style', 'italic'
        assign body_font_bold_italic = body_font_bold | font_modify: 'style', 'italic'
      endif
    %}

    {%- comment -%} TailwindCSS V4 CDN - Cannot use defer as config script requires immediate access {%- endcomment -%}
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: 'var(--color-primary)',
              secondary: 'var(--color-secondary)',
              accent: 'var(--color-accent)',
              background: 'var(--color-background)',
              foreground: 'var(--color-foreground)',
              border: 'var(--color-border)',
              success: 'var(--color-success)',
              warning: 'var(--color-warning)',
              error: 'var(--color-error)',
              'btn-primary': 'var(--button-primary-bg)',
              'btn-primary-text': 'var(--button-primary-text)',
              'btn-secondary': 'var(--button-secondary-bg)',
              'btn-secondary-text': 'var(--button-secondary-text)',
              'footer-bg': '#0a1628',
              'footer-text': '#9ca3af',
              'footer-border': '#374151',
            },
            fontFamily: {
              body: 'var(--font-body-family)',
              heading: 'var(--font-heading-family)',
            },
            borderRadius: {
              btn: 'var(--button-border-radius)',
              sm: 'var(--border-radius-small)',
              md: 'var(--border-radius-medium)',
              lg: 'var(--border-radius-large)',
            },
            transitionDuration: {
              theme: 'var(--transition-duration)',
            },
            maxWidth: {
              page: 'var(--page-width)',
            },
            spacing: {
              section: 'var(--section-spacing)',
              container: 'var(--container-padding)',
              grid: 'var(--grid-gap)',
            },
          },
        },
        corePlugins: {
          preflight: false,
        },
      };
    </script>

    {% style %}
      {%- if settings.font_source == 'shopify' -%}
        {{ settings.body_font | font_face: font_display: 'swap' }}
        {{ body_font_bold | font_face: font_display: 'swap' }}
        {{ body_font_italic | font_face: font_display: 'swap' }}
        {{ body_font_bold_italic | font_face: font_display: 'swap' }}
        {{ settings.heading_font | font_face: font_display: 'swap' }}
      {%- endif -%}

      {%- comment -%} Color Scheme Classes - Dawn-style dynamic generation {%- endcomment -%}
      {%- assign scheme_classes = '' -%}
      {%- for scheme in settings.color_schemes -%}
        {%- assign scheme_classes = scheme_classes | append: ', .color-' | append: scheme.id -%}
        {%- if forloop.index == 1 -%}
          :root,
        {%- endif -%}
        .color-{{ scheme.id }} {
          /* Base colors */
          --color-background: {{ scheme.settings.background }};
          --color-foreground: {{ scheme.settings.text }};
          --color-text: {{ scheme.settings.text }};
          --color-secondary-text: {{ scheme.settings.secondary_text }};
          --color-primary: {{ scheme.settings.button }};
          --color-secondary: {{ scheme.settings.secondary_text }};
          --color-accent: {{ scheme.settings.accent }};
          --color-border: {{ scheme.settings.border }};
          --color-button: {{ scheme.settings.button }};
          --color-button-label: {{ scheme.settings.button_label }};
          --color-card-background: {{ scheme.settings.card_background }};
          --color-card-text: {{ scheme.settings.card_text }};
        }
      {%- endfor -%}

      {{ scheme_classes | prepend: 'body' }} {
        background-color: var(--color-background);
        color: var(--color-foreground);
      }

      :root {
        /* Status Colors */
        --color-success: {{ settings.color_success }};
        --color-warning: {{ settings.color_warning }};
        --color-error: {{ settings.color_error }};

        /* Button Settings - Primary */
        --button-primary-bg: {{ settings.button_primary_bg }};
        --button-primary-text: {{ settings.button_primary_text }};
        --button-primary-bg-hover: {{ settings.button_primary_bg_hover }};
        --button-primary-text-hover: {{ settings.button_primary_text_hover }};

        /* Button Settings - Secondary */
        --button-secondary-bg: {{ settings.button_secondary_bg }};
        --button-secondary-text: {{ settings.button_secondary_text }};
        --button-secondary-border: {{ settings.button_secondary_border }};
        --button-secondary-bg-hover: {{ settings.button_secondary_bg_hover }};
        --button-secondary-text-hover: {{ settings.button_secondary_text_hover }};

        /* Button Settings - Outline */
        --button-outline-text: {{ settings.button_outline_text }};
        --button-outline-border: {{ settings.button_outline_border }};
        --button-outline-bg-hover: {{ settings.button_outline_bg_hover }};
        --button-outline-text-hover: {{ settings.button_outline_text_hover }};

        /* Button Border & Radius */
        --button-border-thickness: {{ settings.button_border_thickness }}px;
        --button-border-opacity: {{ settings.button_border_opacity | divided_by: 100.0 }};
        --button-border-radius: {{ settings.button_radius }}px;

        /* Button Shadow */
        {%- case settings.button_shadow -%}
          {%- when 'small' -%}
            --button-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.08);
          {%- when 'medium' -%}
            --button-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
          {%- when 'large' -%}
            --button-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
          {%- else -%}
            --button-shadow: none;
        {%- endcase -%}
        --button-shadow-hover: {% if settings.button_shadow_on_hover %}0 8px 20px -4px rgba(0, 0, 0, 0.15){% else %}var(--button-shadow){% endif %};

        /* Button Typography */
        --button-font-size: {{ settings.button_font_size_desktop | default: 16 }}px;
        --button-font-size-tablet: {{ settings.button_font_size_tablet | default: 15 }}px;
        --button-font-size-mobile: {{ settings.button_font_size_mobile | default: 14 }}px;
        --button-font-weight: {{ settings.button_font_weight }};
        --button-text-transform: {{ settings.button_text_transform }};

        /* Button Spacing */
        --button-padding-vertical: {{ settings.button_padding_vertical }}px;
        --button-padding-horizontal: {{ settings.button_padding_horizontal }}px;

        /* Button Hover & Transitions */
        --button-hover-scale: {{ settings.button_hover_scale | divided_by: 100.0 }};
        --button-transition-duration: {{ settings.button_transition_duration }}ms;

        /* Button Disabled */
        --button-disabled-opacity: {{ settings.button_disabled_opacity | divided_by: 100.0 }};

        /* Input Settings - Colors */
        --input-bg: {{ settings.input_bg }};
        --input-text: {{ settings.input_text }};
        --input-placeholder: {{ settings.input_placeholder }};

        /* Input Settings - Border */
        --input-border: {{ settings.input_border }};
        --input-border-thickness: {{ settings.input_border_thickness }}px;
        --input-border-radius: {{ settings.input_border_radius }}px;

        /* Input Settings - Focus */
        --input-focus-border: {{ settings.input_focus_border }};
        --input-focus-shadow: {{ settings.input_focus_shadow }};
        --input-focus-shadow-opacity: {{ settings.input_focus_shadow_opacity | divided_by: 100.0 }};

        /* Input Settings - Spacing */
        --input-padding-vertical: {{ settings.input_padding_vertical }}px;
        --input-padding-horizontal: {{ settings.input_padding_horizontal }}px;

        /* Input Settings - Select */
        --select-bg: {{ settings.select_bg }};
        --select-arrow: {{ settings.select_arrow }};

        /* Input Settings - Checkbox/Radio */
        --checkbox-accent: {{ settings.checkbox_accent }};

        /* Input Settings - States */
        --input-error-border: {{ settings.input_error_border }};
        --input-disabled-bg: {{ settings.input_disabled_bg }};
        --input-disabled-opacity: {{ settings.input_disabled_opacity | divided_by: 100.0 }};

        /* Typography - Font Families */
        {%- if settings.font_source == 'google' -%}
          --font-body-family: '{{ settings.google_font_body | default: 'Tajawal' }}', sans-serif;
          --font-body-style: normal;
          --font-body-weight: {{ settings.google_font_body_weight | default: '400' }};

          --font-heading-family: '{{ settings.google_font_heading | default: 'Tajawal' }}', sans-serif;
          --font-heading-style: normal;
          --font-heading-weight: {{ settings.google_font_heading_weight | default: '700' }};
        {%- else -%}
          --font-body-family: {{ settings.body_font.family }}, {{ settings.body_font.fallback_families }};
          --font-body-style: {{ settings.body_font.style }};
          --font-body-weight: {{ settings.body_font.weight }};

          --font-heading-family: {{ settings.heading_font.family }}, {{ settings.heading_font.fallback_families }};
          --font-heading-style: {{ settings.heading_font.style }};
          --font-heading-weight: {{ settings.heading_font.weight }};
        {%- endif -%}

        /* Heading Font Sizes - Desktop */
        --h1-font-size: {{ settings.h1_font_size_desktop | default: 48 }}px;
        --h2-font-size: {{ settings.h2_font_size_desktop | default: 36 }}px;
        --h3-font-size: {{ settings.h3_font_size_desktop | default: 28 }}px;
        --h4-font-size: {{ settings.h4_font_size_desktop | default: 24 }}px;
        --h5-font-size: {{ settings.h5_font_size_desktop | default: 20 }}px;
        --h6-font-size: {{ settings.h6_font_size_desktop | default: 18 }}px;

        /* Heading Font Sizes - Tablet */
        --h1-font-size-tablet: {{ settings.h1_font_size_tablet | default: 40 }}px;
        --h2-font-size-tablet: {{ settings.h2_font_size_tablet | default: 30 }}px;
        --h3-font-size-tablet: {{ settings.h3_font_size_tablet | default: 24 }}px;
        --h4-font-size-tablet: {{ settings.h4_font_size_tablet | default: 20 }}px;
        --h5-font-size-tablet: {{ settings.h5_font_size_tablet | default: 18 }}px;
        --h6-font-size-tablet: {{ settings.h6_font_size_tablet | default: 16 }}px;

        /* Heading Font Sizes - Mobile */
        --h1-font-size-mobile: {{ settings.h1_font_size_mobile | default: 32 }}px;
        --h2-font-size-mobile: {{ settings.h2_font_size_mobile | default: 26 }}px;
        --h3-font-size-mobile: {{ settings.h3_font_size_mobile | default: 22 }}px;
        --h4-font-size-mobile: {{ settings.h4_font_size_mobile | default: 18 }}px;
        --h5-font-size-mobile: {{ settings.h5_font_size_mobile | default: 16 }}px;
        --h6-font-size-mobile: {{ settings.h6_font_size_mobile | default: 14 }}px;

        /* Legacy fallback - for backward compatibility with existing sections */
        --font-heading-size: var(--h2-font-size);
        --font-heading-size-tablet: var(--h2-font-size-tablet);
        --font-heading-size-mobile: var(--h2-font-size-mobile);

        /* Body Font Sizes - Desktop */
        --font-body-size: {{ settings.body_font_size_desktop | default: 20 }}px;

        /* Body Font Sizes - Tablet */
        --font-body-size-tablet: {{ settings.body_font_size_tablet | default: 18 }}px;

        /* Body Font Sizes - Mobile */
        --font-body-size-mobile: {{ settings.body_font_size_mobile | default: 16 }}px;

        /* Line Height */
        --line-height: {{ settings.line_height | default: 160 }}%;

        /* Layout */
        --page-width: {{ settings.page_width }}px;
        --container-padding: {{ settings.container_padding }}px;
        --section-spacing: {{ settings.section_spacing }}px;
        --grid-gap: {{ settings.grid_gap }}px;

        /* Border Radius */
        --border-radius-small: {{ settings.border_radius_small }}px;
        --border-radius-medium: {{ settings.border_radius_medium }}px;
        --border-radius-large: {{ settings.border_radius_large }}px;

        /* Transitions */
        --transition-duration: {{ settings.transition_duration }}ms;
        --transition-timing: ease-in-out;

        /* Button Shadow Values (computed) */
        --button-shadow-value: var(--button-shadow);
        --button-shadow-hover-value: var(--button-shadow-hover);
      }
    {% endstyle %}

    {{ 'base.css' | asset_url | stylesheet_tag }}
    {{ 'component.css' | asset_url | stylesheet_tag }}

    <script>
      document.documentElement.className = document.documentElement.className.replace('no-js', 'js');

      window.Shopify = window.Shopify || {};
      window.Shopify.routes = window.Shopify.routes || {};
      window.Shopify.routes.root = '{{ routes.root_url }}';
      window.Shopify.currency = {
        active: '{{ cart.currency.iso_code }}',
        rate: '{{ cart.currency.rate }}',
        format: {{ shop.money_format | json }},
      };
      window.Shopify.locale = '{{ request.locale.iso_code }}';
      window.Shopify.country = '{{ localization.country.iso_code }}';
    </script>

    <script src="{{ 'theme.js' | asset_url }}" defer></script>
  </head>

  <body class="template-{{ template.name }}{% if template.suffix %} template-{{ template.name }}-{{ template.suffix }}{% endif %} color-scheme-1">
    <a class="skip-to-content-link button visually-hidden" href="#MainContent">
      {{ 'accessibility.skip_to_content' | t }}
    </a>

    {%- sections 'header-group' -%}

    <main id="MainContent" class="main-content" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>

    {%- sections 'footer-group' -%}

    {%- comment -%} Back to Top and Floating Menu are now handled as Footer Section Blocks {%- endcomment -%}
    {%- comment -%}
      To use these features:
      1. Go to Theme Customizer > Footer section
      2. Add "Back to Top" or "Floating Menu" blocks
      3. Configure block settings

      Legacy render calls (kept for reference):
      {%- if settings.enable_back_to_top -%}
        {% render 'back-to-top' %}
      {%- endif -%}
      {% render 'floating-menu' %}
    {%- endcomment -%}

    {%- if settings.enable_cart_drawer -%}
      {% render 'cart-drawer' %}
    {%- endif -%}

    {%- comment -%} Scroll Animations {%- endcomment -%}
    {% render 'scroll-animations' %}

    {%- comment -%} Demo Domain Promo Modal {%- endcomment -%}
    {% render 'demo-promo-modal' %}

    {%- if settings.enable_quick_view -%}
      {% render 'quick-view-modal' %}
    {%- endif -%}

    {% render 'quick-add-modal' %}

    {%- if settings.enable_search_modal -%}
      {% render 'search-modal' %}
    {%- endif -%}

    <script>
      window.shopUrl = '{{ request.origin }}';
      window.routes = {
        root_url: '{{ routes.root_url }}',
        cart_url: '{{ routes.cart_url }}',
        cart_add_url: '{{ routes.cart_add_url }}',
        cart_change_url: '{{ routes.cart_change_url }}',
        cart_update_url: '{{ routes.cart_update_url }}',
        predictive_search_url: '{{ routes.predictive_search_url }}',
        all_products_collection_url: '{{ routes.all_products_collection_url }}',
      };

      window.cartStrings = {
        error: `{{ 'cart.general.error' | t }}`,
        quantityError: `{{ 'cart.general.quantity_error' | t: quantity: '[quantity]' }}`,
        empty: `{{ 'cart.general.empty' | t }}`,
        empty_description: `{{ 'cart.general.empty_description' | t | default: 'لم تقم بإضافة أي منتجات إلى سلة التسوق بعد' }}`,
        continue_shopping: `{{ 'cart.general.continue_shopping' | t }}`,
        one_item: `{{ 'cart.general.item_count.one' | t: count: 1 }}`,
        items: `{{ 'cart.general.item_count.other' | t: count: '[count]' }}`,
      };

      window.variantStrings = {
        addToCart: `{{ 'products.product.add_to_cart' | t }}`,
        soldOut: `{{ 'products.product.sold_out' | t }}`,
        unavailable: `{{ 'products.product.unavailable' | t }}`,
        inStock: `{{ 'products.product.inventory_in_stock' | t }}`,
        lowStock: `{{ 'products.product.inventory_low_stock' | t }}`,
      };
    </script>
    {% comment %} {% render 'license-verification' %} {% endcomment %}
  </body>
</html>
