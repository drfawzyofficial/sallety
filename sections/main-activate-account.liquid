{%- comment -%}
  Main Activate Account Section
  Simplified design using color_scheme
  Centered form with RTL layout
{%- endcomment -%}

{%- liquid
  # Color scheme class (uses CSS classes from theme.liquid)
  assign scheme_number = section.settings.color_scheme.id | remove: 'scheme-'
  
  # Layout Settings
  assign card_radius = section.settings.card_radius | default: 24
-%}

{%- capture section_dir -%}{%- render 'section-dir' -%}{%- endcapture -%}
<section 
  class="main-activate-account color-scheme-{{ scheme_number }} py-12 lg:py-16"
  dir="{{ section_dir }}"
  style="
    --activate-card-radius: {{ card_radius }}px;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  "
>
  <div class="activate-card w-full max-w-md" style="background: var(--color-card-background); border-radius: var(--activate-card-radius); box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
    <div class="p-6 sm:p-8 lg:p-10">
      <!-- User Circle Icon -->
      <div class="user-icon flex items-center justify-center mb-6">
        <div class="w-24 h-24 rounded-full flex items-center justify-center" style="border: 2px solid var(--color-border);">
          <svg class="w-12 h-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--color-secondary-text);">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
      </div>

      <!-- Header -->
      <div class="activate-header text-center mb-8">
        <h1 class="activate-title mb-2" style="color: var(--color-accent);">
          {{ section.settings.page_title | default: 'تفعيل حسابك' }}
        </h1>
        <p class="activate-subtitle" style="color: var(--color-secondary-text);">
          {{ section.settings.page_subtitle | default: 'قم بإنشاء كلمة مرور لتفعيل حسابك' }}
        </p>
      </div>

      {%- form 'activate_customer_password', class: 'activate-form' -%}
        {%- if form.errors -%}
          <div class="activate-alert activate-alert--error mb-6" style="background: color-mix(in srgb, var(--color-error) 10%, transparent); border: 1px solid color-mix(in srgb, var(--color-error) 30%, transparent); color: var(--color-error); padding: 12px 16px; border-radius: var(--input-border-radius, 8px); display: flex; align-items: center; gap: 10px;">
            <svg class="w-5 h-5 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="12"/>
              <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <span>{{ form.errors | default_errors }}</span>
          </div>
        {%- endif -%}

        <!-- Password Field -->
        <div class="activate-field mb-5">
          <label for="activatePassword" class="activate-label block mb-2 font-medium" style="color: var(--color-text);">
            {{ 'customer.activate_account.password' | t }}
          </label>
          <div class="activate-password-wrapper relative">
            <input 
              type="password" 
              id="activatePassword"
              name="customer[password]"
              class="activate-input w-full"
              placeholder="••••••••"
              autocomplete="new-password"
              required
              style="
                height: 52px;
                padding-left: 48px;
                direction: ltr;
                text-align: right;
              "
            >
            <button 
              type="button" 
              class="activate-password-toggle absolute left-3 top-1/2 -translate-y-1/2 p-2"
              onclick="toggleActivatePassword(this)"
              style="color: var(--color-secondary-text);"
            >
              <svg class="icon-show w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="icon-hide w-5 h-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Confirm Password Field -->
        <div class="activate-field mb-6">
          <label for="activatePasswordConfirm" class="activate-label block mb-2 font-medium" style="color: var(--color-text);">
            {{ 'customer.activate_account.password_confirm' | t }}
          </label>
          <div class="activate-password-wrapper relative">
            <input 
              type="password" 
              id="activatePasswordConfirm"
              name="customer[password_confirmation]"
              class="activate-input w-full"
              placeholder="••••••••"
              autocomplete="new-password"
              required
              style="
                height: 52px;
                padding-left: 48px;
                direction: ltr;
                text-align: right;
              "
            >
            <button 
              type="button" 
              class="activate-password-toggle absolute left-3 top-1/2 -translate-y-1/2 p-2"
              onclick="toggleActivatePassword(this)"
              style="color: var(--color-secondary-text);"
            >
              <svg class="icon-show w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="icon-hide w-5 h-5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
          <p class="mt-2 text-sm" style="color: var(--color-secondary-text);">
            {{ 'customer.forms.errors.password_too_short' | t | default: 'يجب أن تتكون كلمة المرور من 5 أحرف على الأقل' }}
          </p>
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="activate-submit-btn btn btn--primary w-full"
          style="
            height: 56px;
            color: var(--color-button-label);
            background: var(--color-button);
            border: none;
          "
        >
          {{ section.settings.btn_text | default: 'تفعيل الحساب' }}
        </button>

        <!-- Decline Button -->
        <button 
          type="submit"
          name="decline"
          class="activate-decline-btn btn btn--secondary w-full mt-4"
          style="
            height: 52px;
            color: var(--color-secondary-text);
            background: transparent;
            border: 2px solid var(--color-border);
          "
        >
          {{ section.settings.decline_text | default: 'رفض الدعوة' }}
        </button>
      {%- endform -%}
    </div>
  </div>
</section>

<style>
  .main-activate-account .activate-input:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 4px color-mix(in srgb, var(--color-accent) 10%, transparent);
  }

  .main-activate-account .activate-input:hover:not(:focus) {
    border-color: color-mix(in srgb, var(--color-accent) 50%, transparent);
  }

  .main-activate-account .activate-submit-btn:hover {
    filter: brightness(1.1);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px color-mix(in srgb, var(--color-button) 40%, transparent);
  }

  .main-activate-account .activate-submit-btn:active {
    transform: translateY(0);
  }

  .main-activate-account .activate-decline-btn:hover {
    border-color: var(--color-error);
    color: var(--color-error);
  }

  .main-activate-account .activate-password-toggle:hover {
    color: var(--color-text);
  }

  @media (prefers-reduced-motion: reduce) {
    .main-activate-account .activate-submit-btn,
    .main-activate-account .activate-decline-btn,
    .main-activate-account .activate-input {
      transition: none !important;
    }
  }
</style>

<script>
  function toggleActivatePassword(button) {
    const input = button.previousElementSibling;
    const iconShow = button.querySelector('.icon-show');
    const iconHide = button.querySelector('.icon-hide');
    
    if (input.type === 'password') {
      input.type = 'text';
      iconShow.classList.add('hidden');
      iconHide.classList.remove('hidden');
    } else {
      input.type = 'password';
      iconShow.classList.remove('hidden');
      iconHide.classList.add('hidden');
    }
  }
</script>

{% schema %}
{
  "name": "t:sections.main_activate_account.name",
  "tag": "section",
  "class": "section-main-activate-account",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.main_activate_account.settings.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.main_activate_account.settings.header.content"
    },
    {
      "type": "text",
      "id": "page_title",
      "label": "t:sections.main_activate_account.settings.page_title.label",
      "default": "تفعيل حسابك"
    },
    {
      "type": "text",
      "id": "page_subtitle",
      "label": "t:sections.main_activate_account.settings.page_subtitle.label",
      "default": "قم بإنشاء كلمة مرور لتفعيل حسابك"
    },
    {
      "type": "text",
      "id": "btn_text",
      "label": "t:sections.main_activate_account.settings.btn_text.label",
      "default": "تفعيل الحساب"
    },
    {
      "type": "text",
      "id": "decline_text",
      "label": "t:sections.main_activate_account.settings.decline_text.label",
      "default": "رفض الدعوة"
    },
    {
      "type": "header",
      "content": "t:sections.main_activate_account.settings.header.content"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "t:sections.main_activate_account.settings.card_radius.label",
      "default": 24,
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px"
    }
  ]
}
{% endschema %}
