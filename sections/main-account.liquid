{%- comment -%}
  Main Account Section
  Simplified design using color_scheme
  RTL layout - Customer Profile Dashboard
{%- endcomment -%}

{%- liquid
  # Color scheme class (uses CSS classes from theme.liquid)
  assign scheme_number = section.settings.color_scheme.id | remove: 'scheme-'

  # Layout Settings
  assign card_radius = section.settings.card_radius | default: 16
-%}

{%- capture section_dir -%}{%- render 'section-dir' -%}{%- endcapture -%}
<section
  class="main-account color-scheme-{{ scheme_number }} py-8 lg:py-12"
  dir="{{ section_dir }}"
  style="
    --account-card-radius: {{ card_radius }}px;
    min-height: 100vh;
  "
>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl">
    <!-- Header -->
    <div class="account-header mb-8 lg:mb-12">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 class="account-title mb-2" style="color: var(--color-accent);">
            {{ 'customer.account.title' | t }}
          </h1>
          <p class="account-welcome" style="color: var(--color-secondary-text);">
            {{ 'customer.account.welcome' | t }}
            {{ customer.first_name | default: customer.email }}!
          </p>
        </div>
        <a
          href="{{ routes.account_logout_url }}"
          class="account-logout-btn btn btn--secondary inline-flex items-center gap-2 px-5 py-3"
          style="
            color: var(--color-secondary-text);
            border: 2px solid var(--color-border);
          "
        >
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          {{ 'customer.account.logout' | t }}
        </a>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
      <!-- Sidebar - Account Info -->
      <div class="lg:col-span-1">
        <!-- Profile Card -->
        <div
          class="account-card p-6 mb-6"
          style="background: var(--color-card-background); border-radius: var(--account-card-radius); box-shadow: 0 2px 8px rgba(0,0,0,0.04);"
        >
          <div class="flex items-center gap-4 mb-6">
            <div
              class="account-avatar w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold"
              style="background: color-mix(in srgb, var(--color-accent) 10%, transparent); color: var(--color-accent);"
            >
              {{ customer.first_name | slice: 0 | upcase | default: customer.email | slice: 0 | upcase }}
            </div>
            <div>
              <h3 class="font-semibold text-lg" style="color: var(--color-accent);">
                {{ customer.name | default: customer.email }}
              </h3>
              <p class="text-sm" style="color: var(--color-secondary-text);">
                {{ customer.email }}
              </p>
            </div>
          </div>

          <div class="account-stats grid grid-cols-2 gap-4 pt-6" style="border-top: 1px solid var(--color-border);">
            <div class="text-center">
              <p class="text-2xl font-bold" style="color: var(--color-accent);">{{ customer.orders_count }}</p>
              <p class="text-sm" style="color: var(--color-secondary-text);">
                {{ 'customer.account.orders_count' | t }}
              </p>
            </div>
            <div class="text-center">
              <p class="text-2xl font-bold" style="color: var(--color-accent);">{{ customer.addresses.size }}</p>
              <p class="text-sm" style="color: var(--color-secondary-text);">
                {{ 'customer.account.addresses_count' | t }}
              </p>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div
          class="account-card p-6"
          style="background: var(--color-card-background); border-radius: var(--account-card-radius); box-shadow: 0 2px 8px rgba(0,0,0,0.04);"
        >
          <h3 class="font-semibold mb-4" style="color: var(--color-accent);">
            {{ 'customer.account.quick_links' | t }}
          </h3>
          <nav class="account-nav flex flex-col gap-2">
            <a
              href="{{ routes.account_addresses_url }}"
              class="account-nav-link flex items-center gap-3 p-3 rounded-lg transition-colors"
              style="color: var(--color-text);"
            >
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              {{ 'customer.account.view_addresses' | t }}
            </a>
            <a
              href="{{ routes.root_url }}"
              class="account-nav-link flex items-center gap-3 p-3 rounded-lg transition-colors"
              style="color: var(--color-text);"
            >
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                <line x1="3" y1="6" x2="21" y2="6"/>
                <path d="M16 10a4 4 0 0 1-8 0"/>
              </svg>
              {{ 'cart.general.continue_shopping' | t }}
            </a>
          </nav>
        </div>
      </div>

      <!-- Main Content - Orders -->
      <div class="lg:col-span-2">
        <div
          class="account-card p-6 lg:p-8"
          style="background: var(--color-card-background); border-radius: var(--account-card-radius); box-shadow: 0 2px 8px rgba(0,0,0,0.04);"
        >
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-semibold" style="color: var(--color-accent);">
              {{ 'customer.account.orders_title' | t }}
            </h2>
          </div>

          {%- if customer.orders.size > 0 -%}
            <div class="account-orders-list">
              {%- for order in customer.orders -%}
                <div
                  class="account-order-item p-4 mb-4 rounded-lg transition-colors"
                  style="background: color-mix(in srgb, var(--color-background) 50%, transparent); border: 1px solid var(--color-border);"
                >
                  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-3 mb-2">
                        <a
                          href="{{ order.customer_url }}"
                          class="font-semibold hover:underline"
                          style="color: var(--color-accent);"
                        >
                          {{ order.name }}
                        </a>
                        <span
                          class="account-order-status px-3 py-1 rounded-full text-xs font-medium"
                          style="
                            {% if order.fulfillment_status == 'fulfilled' %}
                              background: color-mix(in srgb, var(--color-success) 10%, transparent);
                              color: var(--color-success);
                            {% elsif order.fulfillment_status == 'partial' %}
                              background: color-mix(in srgb, var(--color-warning) 10%, transparent);
                              color: var(--color-warning);
                            {% else %}
                              background: color-mix(in srgb, var(--color-secondary-text) 10%, transparent);
                              color: var(--color-secondary-text);
                            {% endif %}
                          "
                        >
                          {{ order.fulfillment_status_label }}
                        </span>
                      </div>
                      <div
                        class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm"
                        style="color: var(--color-secondary-text);"
                      >
                        <span>{{ order.created_at | date: '%d/%m/%Y' }}</span>
                        <span>•</span>
                        <span>
                          {{- order.line_items.size }}
                          {{ 'customer.account.product_count' | t -}}
                        </span>
                        <span>•</span>
                        <span class="font-medium" style="color: var(--color-accent);">
                          {{- order.total_price | money -}}
                        </span>
                      </div>
                    </div>
                    <a
                      href="{{ order.customer_url }}"
                      class="btn btn--primary inline-flex items-center gap-2 px-4 py-2 text-sm"
                    >
                      {{ 'customer.account.view_details' | t }}
                      <svg
                        class="w-4 h-4 rotate-180"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="m15 18-6-6 6-6"/>
                      </svg>
                    </a>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          {%- else -%}
            <div class="account-empty text-center py-12">
              <div
                class="w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center"
                style="background: color-mix(in srgb, var(--color-secondary-text) 10%, transparent);"
              >
                <svg
                  class="w-10 h-10"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                  style="color: var(--color-secondary-text);"
                >
                  <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                  <line x1="3" y1="6" x2="21" y2="6"/>
                  <path d="M16 10a4 4 0 0 1-8 0"/>
                </svg>
              </div>
              <h3 class="text-lg font-semibold mb-2" style="color: var(--color-accent);">
                {{ 'customer.account.empty_orders_title' | t }}
              </h3>
              <p class="mb-6" style="color: var(--color-secondary-text);">
                {{ 'customer.account.empty_orders_text' | t }}
              </p>
              <a
                href="{{ routes.all_products_collection_url }}"
                class="btn btn--primary inline-flex items-center gap-2 px-6 py-3"
              >
                {{ 'customer.account.shop_now' | t }}
                <svg class="w-5 h-5 rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m15 18-6-6 6-6"/>
                </svg>
              </a>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .main-account .account-logout-btn:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  .main-account .account-nav-link:hover {
    background: color-mix(in srgb, var(--color-accent) 8%, transparent);
    color: var(--color-accent);
  }

  .main-account .account-order-item:hover {
    border-color: var(--color-accent);
  }

  .main-account .btn--primary:hover {
    filter: brightness(1.1);
    transform: translateY(-1px);
  }

  @media (prefers-reduced-motion: reduce) {
    .main-account a,
    .main-account .account-order-item {
      transition: none !important;
    }
  }
</style>

{% schema %}
{
  "name": "t:sections.main_account.name",
  "tag": "section",
  "class": "section-main-account",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.main_account.settings.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "t:sections.main_account.settings.card_radius.label",
      "default": 16,
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px"
    }
  ]
}
{% endschema %}
