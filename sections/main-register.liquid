{%- comment -%}
  Main Register Section
  Simplified design using color_scheme
  Centered form with RTL layout
{%- endcomment -%}

{%- liquid
  # Color scheme class (uses CSS classes from theme.liquid)
  assign scheme_number = section.settings.color_scheme.id | remove: 'scheme-'

  # Layout Settings
  assign card_radius = section.settings.card_radius | default: 24
-%}

{%- capture section_dir -%}{%- render 'section-dir' -%}{%- endcapture -%}
<section
  class="main-register color-scheme-{{ scheme_number }} py-12 lg:py-16"
  dir="{{ section_dir }}"
  style="
    --register-card-radius: {{ card_radius }}px;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  "
>
  <div class="register-wrapper w-full max-w-md mx-auto px-4 sm:px-6">
    <div
      class="register-card"
      style="background: var(--color-card-background); border-radius: var(--register-card-radius); box-shadow: 0 10px 40px rgba(0,0,0,0.08);"
    >
      <div class="p-6 sm:p-8 lg:p-10">
        <!-- User Circle Icon -->
        <div class="user-icon flex items-center justify-center mb-6">
          <div
            class="w-24 h-24 rounded-full flex items-center justify-center"
            style="border: 2px solid var(--color-border);"
          >
            <svg
              class="w-12 h-12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              style="color: var(--color-secondary-text);"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
        </div>

        <!-- Header -->
        <div class="register-header text-center mb-8">
          <h1 class="register-title mb-2" style="color: var(--color-accent);">
            {{ 'customer.register.title' | t }}
          </h1>
          <p class="register-subtitle" style="color: var(--color-secondary-text);">
            {{ 'customer.register.subtitle' | t }}
          </p>
        </div>

        {%- form 'create_customer', class: 'register-form' -%}
          {%- if form.errors -%}
            <div
              class="register-alert register-alert--error mb-6"
              style="background: color-mix(in srgb, var(--color-error) 10%, transparent); border: 1px solid color-mix(in srgb, var(--color-error) 30%, transparent); color: var(--color-error); padding: 12px 16px; border-radius: var(--input-border-radius, 8px); display: flex; align-items: center; gap: 10px;"
            >
              <svg class="w-5 h-5 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
              <span>{{ form.errors | default_errors }}</span>
            </div>
          {%- endif -%}

          <!-- First Name -->
          <div class="register-field mb-5">
            <label
              for="registerFirstName"
              class="register-label block mb-2 font-medium"
              style="color: var(--color-text);"
            >
              {{ 'customer.register.first_name' | t }}
            </label>
            <input
              type="text"
              id="registerFirstName"
              name="customer[first_name]"
              class="register-input w-full"
              placeholder="{{ 'customer.register.first_name_placeholder' | t }}"
              autocomplete="given-name"
              required
              style="height: 52px;"
            >
          </div>

          <!-- Last Name -->
          <div class="register-field mb-5">
            <label
              for="registerLastName"
              class="register-label block mb-2 font-medium"
              style="color: var(--color-text);"
            >
              {{ 'customer.register.last_name' | t }}
            </label>
            <input
              type="text"
              id="registerLastName"
              name="customer[last_name]"
              class="register-input w-full"
              placeholder="{{ 'customer.register.last_name_placeholder' | t }}"
              autocomplete="family-name"
              required
              style="height: 52px;"
            >
          </div>

          <!-- Email Field -->
          <div class="register-field mb-5">
            <label for="registerEmail" class="register-label block mb-2 font-medium" style="color: var(--color-text);">
              {{ 'customer.register.email' | t }}
            </label>
            <input
              type="email"
              id="registerEmail"
              name="customer[email]"
              class="register-input w-full"
              placeholder="your@email.com"
              autocomplete="email"
              autocapitalize="off"
              required
              style="
                height: 52px;
                direction: ltr;
                text-align: right;
              "
            >
          </div>

          <!-- Password Field -->
          <div class="register-field mb-6">
            <label
              for="registerPassword"
              class="register-label block mb-2 font-medium"
              style="color: var(--color-text);"
            >
              {{ 'customer.register.password' | t }}
            </label>
            <div class="register-password-wrapper relative">
              <input
                type="password"
                id="registerPassword"
                name="customer[password]"
                class="register-input w-full"
                placeholder="••••••••"
                autocomplete="new-password"
                required
                style="
                  height: 52px;
                  padding-left: 48px;
                  direction: ltr;
                  text-align: right;
                "
              >
              <button
                type="button"
                class="register-password-toggle absolute left-3 top-1/2 -translate-y-1/2 p-2"
                onclick="toggleRegisterPassword(this)"
                style="color: var(--color-secondary-text);"
              >
                <svg class="icon-show w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                <svg
                  class="icon-hide w-5 h-5 hidden"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                  <line x1="1" y1="1" x2="23" y2="23"/>
                </svg>
              </button>
            </div>
            <p class="mt-2 text-sm" style="color: var(--color-secondary-text);">
              {{
                'customer.forms.errors.password_too_short'
                | t
                | default: 'يجب أن تتكون كلمة المرور من 5 أحرف على الأقل'
              }}
            </p>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            class="register-submit-btn btn btn--primary w-full"
            style="
              height: 56px;
              border: none;
            "
          >
            {{ 'customer.register.submit' | t }}
          </button>
        {%- endform -%}

        <!-- Login Link -->
        <p class="register-footer text-center mt-6" style="color: var(--color-secondary-text);">
          {{ 'customer.register.already_have_account' | t }}
          <a
            href="{{ routes.account_login_url }}"
            class="font-semibold transition-colors"
            style="color: var(--color-accent);"
          >
            {{ 'customer.log_in' | t }}
          </a>
        </p>
      </div>
    </div>
  </div>
</section>

<style>
  .main-register .register-input:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 4px color-mix(in srgb, var(--color-accent) 10%, transparent);
  }

  .main-register .register-input:hover:not(:focus) {
    border-color: color-mix(in srgb, var(--color-accent) 50%, transparent);
  }

  .main-register .register-submit-btn:hover {
    filter: brightness(1.1);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px color-mix(in srgb, var(--color-button) 40%, transparent);
  }

  .main-register .register-submit-btn:active {
    transform: translateY(0);
  }

  .main-register .register-password-toggle:hover {
    color: var(--color-text);
  }

  @media (prefers-reduced-motion: reduce) {
    .main-register .register-submit-btn,
    .main-register .register-input {
      transition: none !important;
    }
  }
</style>

<script>
  function toggleRegisterPassword(button) {
    const input = button.previousElementSibling;
    const iconShow = button.querySelector('.icon-show');
    const iconHide = button.querySelector('.icon-hide');

    if (input.type === 'password') {
      input.type = 'text';
      iconShow.classList.add('hidden');
      iconHide.classList.remove('hidden');
    } else {
      input.type = 'password';
      iconShow.classList.remove('hidden');
      iconHide.classList.add('hidden');
    }
  }
</script>

{% schema %}
{
  "name": "t:sections.main_register.name",
  "tag": "section",
  "class": "section-main-register",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.main_register.settings.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "t:sections.main_register.settings.card_radius.label",
      "default": 24,
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px"
    }
  ]
}
{% endschema %}
