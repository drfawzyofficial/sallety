{%- comment -%}
  Sallety Theme - Collection List Section
  Premium grid/carousel of featured collections with hover effects, RTL support
{%- endcomment -%}

{%- liquid
  assign scheme_number = section.settings.color_scheme | default: 'scheme-1' | remove: 'scheme-'
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign description = section.settings.description
  assign text_alignment = section.settings.text_alignment | default: 'center'
  assign columns_desktop = section.settings.columns_desktop | default: 3
  assign columns_tablet = section.settings.columns_tablet | default: 2
  assign columns_mobile = section.settings.columns_mobile | default: 1
  assign image_ratio = section.settings.image_ratio | default: 'portrait'
  assign card_style = section.settings.card_style | default: 'overlay'
  assign overlay_opacity = section.settings.overlay_opacity | default: 40
  assign corner_radius = section.settings.corner_radius | default: 16
  assign show_count = section.settings.show_count
  assign show_view_all = section.settings.show_view_all
  assign view_all_link = section.settings.view_all_link
  assign show_shapes = section.settings.show_shapes
  assign heading_weight = section.settings.heading_weight | default: '700'
  assign hover_effect = section.settings.hover_effect | default: 'zoom'
  assign padding_top = section.settings.padding_top | default: 60
  assign padding_bottom = section.settings.padding_bottom | default: 60

  assign rtl_langs = settings.rtl_languages | default: 'ar,he,fa,ur' | split: ','
  assign current_lang = request.locale.iso_code | slice: 0, 2 | downcase
  assign is_rtl_lang = false
  for lang in rtl_langs
    assign lang_trimmed = lang | strip | downcase
    if current_lang == lang_trimmed
      assign is_rtl_lang = true
      break
    endif
  endfor
  assign section_dir = 'ltr'
  if settings.enable_rtl and is_rtl_lang
    assign section_dir = 'rtl'
  endif
-%}

<section
  class="cl-section color-scheme-{{ scheme_number }} relative overflow-hidden animate-on-scroll aos-fade-up"
  id="CollectionList-{{ section.id }}"
  dir="{{ section_dir }}"
  style="
    --cl-columns-desktop: {{ columns_desktop }};
    --cl-columns-tablet: {{ columns_tablet }};
    --cl-columns-mobile: {{ columns_mobile }};
    --cl-corner-radius: {{ corner_radius }}px;
    --cl-overlay-opacity: {{ overlay_opacity | divided_by: 100.0 }};
    --cl-heading-weight: {{ heading_weight }};
    padding-top: {{ padding_top }}px;
    padding-bottom: {{ padding_bottom }}px;
    font-family: var(--font-body-family);
  "
>
  {%- if show_shapes -%}
    <div class="cl-shapes" aria-hidden="true">
      <div class="cl-shape cl-shape-1"></div>
      <div class="cl-shape cl-shape-2"></div>
      <div class="cl-shape cl-shape-3"></div>
    </div>
  {%- endif -%}

  <div class="cl-container max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    {%- comment -%} Section Header {%- endcomment -%}
    <div class="cl-header" style="text-align: {{ text_alignment }};">
      {%- if subheading != blank -%}
        <span class="cl-subheading animate-on-scroll aos-fade-up">{{ subheading }}</span>
      {%- endif -%}

      {%- if heading != blank -%}
        <h2 class="cl-heading animate-on-scroll aos-fade-up" style="font-weight: var(--cl-heading-weight);">
          {{ heading }}
        </h2>
      {%- endif -%}

      {%- if description != blank -%}
        <div
          class="cl-description rte animate-on-scroll aos-fade-up"
          {% if text_alignment == 'center' %}
            style="margin-inline: auto;"
          {% endif %}
        >
          {{ description }}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Collection Grid {%- endcomment -%}
    <div class="cl-grid animate-on-scroll aos-fade-up" data-aos-delay="200">
      {%- for block in section.blocks -%}
        {%- liquid
          assign collection = block.settings.collection
          assign custom_image = block.settings.custom_image
          assign custom_title = block.settings.custom_title
          assign show_image = false
          if custom_image != blank
            assign show_image = true
          elsif collection.image != blank
            assign show_image = true
          elsif collection.featured_image != blank
            assign show_image = true
          endif

          assign display_title = custom_title
          if display_title == blank and collection != blank
            assign display_title = collection.title
          endif
          if display_title == blank
            assign display_title = 'مجموعة ' | append: forloop.index
          endif

          assign col_url = collection.url | default: '#'
          assign products_count = collection.products_count | default: 0
        -%}

        <div class="cl-card cl-card--{{ card_style }} cl-card--hover-{{ hover_effect }}" {{ block.shopify_attributes }}>
          <a href="{{ col_url }}" class="cl-card__link" aria-label="{{ display_title }}">
            <div class="cl-card__image-wrap cl-ratio--{{ image_ratio }}">
              {%- if custom_image != blank -%}
                {{
                  custom_image
                  | image_url: width: 800
                  | image_tag:
                    loading: 'lazy',
                    class: 'cl-card__image',
                    widths: '400,600,800',
                    sizes: '(max-width: 640px) 100vw, (max-width: 1023px) 50vw, 33vw'
                }}
              {%- elsif collection != blank and collection.image != blank -%}
                {{
                  collection.image
                  | image_url: width: 800
                  | image_tag:
                    loading: 'lazy',
                    class: 'cl-card__image',
                    widths: '400,600,800',
                    sizes: '(max-width: 640px) 100vw, (max-width: 1023px) 50vw, 33vw'
                }}
              {%- elsif collection != blank and collection.products.first.featured_image != blank -%}
                {{
                  collection.products.first.featured_image
                  | image_url: width: 800
                  | image_tag:
                    loading: 'lazy',
                    class: 'cl-card__image',
                    widths: '400,600,800',
                    sizes: '(max-width: 640px) 100vw, (max-width: 1023px) 50vw, 33vw'
                }}
              {%- else -%}
                <div class="cl-card__placeholder">
                  {{ 'collection-1' | placeholder_svg_tag: 'cl-card__placeholder-svg' }}
                </div>
              {%- endif -%}

              {%- if card_style == 'overlay' -%}
                <div class="cl-card__overlay"></div>
              {%- endif -%}
            </div>

            <div class="cl-card__content cl-card__content--{{ card_style }}">
              <h3 class="cl-card__title">{{ display_title }}</h3>

              {%- if show_count and collection != blank -%}
                <span class="cl-card__count">
                  {{ products_count }}
                  {{ 'sections.collection_list.products' | t | default: 'منتج' }}
                </span>
              {%- endif -%}

              <span class="cl-card__arrow">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
                </svg>
              </span>
            </div>
          </a>
        </div>
      {%- else -%}
        {%- comment -%} Placeholder cards when no blocks added {%- endcomment -%}
        {%- for i in (1..3) -%}
          <div class="cl-card cl-card--{{ card_style }}">
            <div class="cl-card__link">
              <div class="cl-card__image-wrap cl-ratio--{{ image_ratio }}">
                <div class="cl-card__placeholder">
                  {{ 'collection-' | append: i | placeholder_svg_tag: 'cl-card__placeholder-svg' }}
                </div>
                {%- if card_style == 'overlay' -%}
                  <div class="cl-card__overlay"></div>
                {%- endif -%}
              </div>
              <div class="cl-card__content cl-card__content--{{ card_style }}">
                <h3 class="cl-card__title">
                  {{ 'sections.collection_list.placeholder' | t | default: 'اسم المجموعة' }}
                  {{ i }}
                </h3>
              </div>
            </div>
          </div>
        {%- endfor -%}
      {%- endfor -%}
    </div>

    {%- if show_view_all -%}
      <div
        class="cl-view-all animate-on-scroll aos-fade-up"
        data-aos-delay="400"
        style="text-align: {{ text_alignment }};"
      >
        <a href="{{ view_all_link | default: routes.collections_url }}" class="btn btn--outline cl-view-all-btn">
          {{ 'sections.collection_list.view_all' | t | default: 'عرض جميع المجموعات' }}
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="cl-arrow-icon"
          >
            <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
          </svg>
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<style>
  /* ===== Grid ===== */
  .cl-grid {
    display: grid;
    grid-template-columns: repeat(var(--cl-columns-desktop), 1fr);
    gap: 24px;
  }

  @media (max-width: 1023px) {
    .cl-grid {
      grid-template-columns: repeat(var(--cl-columns-tablet), 1fr);
      gap: 20px;
    }
  }

  @media (max-width: 639px) {
    .cl-grid {
      grid-template-columns: repeat(var(--cl-columns-mobile), 1fr);
      gap: 16px;
    }
  }

  /* ===== Header ===== */
  .cl-header {
    margin-bottom: 40px;
  }

  .cl-subheading {
    display: inline-block;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-accent, var(--color-primary));
    margin-bottom: 12px;
  }

  .cl-heading {
    font-size: clamp(1.75rem, 4vw, 2.75rem);
    color: var(--color-text);
    line-height: 1.2;
    margin: 0 0 12px;
    font-family: var(--font-heading-family, var(--font-body-family));
  }

  .cl-description {
    font-size: 1rem;
    color: var(--color-secondary-text);
    line-height: 1.7;
    max-width: 600px;
  }

  /* ===== Card Base ===== */
  .cl-card {
    border-radius: var(--cl-corner-radius);
    overflow: hidden;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.4s ease;
  }

  .cl-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  }

  .cl-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
    height: 100%;
  }

  /* ===== Image Ratios ===== */
  .cl-card__image-wrap {
    position: relative;
    overflow: hidden;
  }

  .cl-ratio--portrait {
    aspect-ratio: 3/4;
  }
  .cl-ratio--square {
    aspect-ratio: 1/1;
  }
  .cl-ratio--landscape {
    aspect-ratio: 4/3;
  }
  .cl-ratio--wide {
    aspect-ratio: 16/9;
  }

  .cl-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .cl-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-card-background, #f5f5f5);
  }

  .cl-card__placeholder-svg {
    width: 60%;
    height: auto;
    opacity: 0.3;
  }

  /* ===== Hover Effects ===== */
  .cl-card--hover-zoom:hover .cl-card__image {
    transform: scale(1.08);
  }

  .cl-card--hover-rotate:hover .cl-card__image {
    transform: scale(1.05) rotate(2deg);
  }

  .cl-card--hover-brighten:hover .cl-card__image {
    filter: brightness(1.1);
    transform: scale(1.03);
  }

  /* ===== Overlay Card Style ===== */
  .cl-card__overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, transparent 30%, rgba(0, 0, 0, var(--cl-overlay-opacity)) 100%);
    transition: opacity 0.4s ease;
    z-index: 2;
  }

  .cl-card:hover .cl-card__overlay {
    opacity: 0.85;
  }

  .cl-card__content--overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 24px;
    z-index: 3;
    color: #fff;
  }

  .cl-card__content--overlay .cl-card__title {
    color: #fff;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .cl-card__content--overlay .cl-card__count {
    color: rgba(255, 255, 255, 0.8);
  }

  .cl-card__content--overlay .cl-card__arrow {
    color: #fff;
  }

  /* ===== Below Card Style ===== */
  .cl-card--below {
    background: var(--color-card-background, #fff);
    border: 1px solid var(--color-border, rgba(0, 0, 0, 0.08));
  }

  .cl-card__content--below {
    padding: 16px 20px;
  }

  .cl-card__content--below .cl-card__title {
    color: var(--color-text);
  }

  .cl-card__content--below .cl-card__count {
    color: var(--color-secondary-text);
  }

  /* ===== Minimal Card Style ===== */
  .cl-card--minimal .cl-card__content--minimal {
    padding: 12px 0;
  }

  .cl-card--minimal .cl-card__title {
    color: var(--color-text);
  }

  /* ===== Card Content ===== */
  .cl-card__title {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0 0 4px;
    line-height: 1.3;
    font-family: var(--font-heading-family, var(--font-body-family));
  }

  .cl-card__count {
    font-size: 0.85rem;
    font-weight: 400;
    display: block;
  }

  .cl-card__arrow {
    display: inline-flex;
    margin-top: 8px;
    opacity: 0;
    transform: translateX(-8px);
    transition: all 0.3s ease;
  }

  [dir='rtl'] .cl-card__arrow {
    transform: translateX(8px);
  }

  [dir='rtl'] .cl-card__arrow svg {
    transform: scaleX(-1);
  }

  .cl-card:hover .cl-card__arrow {
    opacity: 1;
    transform: translateX(0);
  }

  /* ===== View All ===== */
  .cl-view-all {
    margin-top: 40px;
  }

  .cl-view-all-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 14px 32px;
    border-radius: var(--cl-corner-radius);
    font-weight: 600;
    transition: all 0.3s ease;
  }

  [dir='rtl'] .cl-arrow-icon {
    transform: scaleX(-1);
  }

  /* ===== Decorative Shapes ===== */
  .cl-shapes {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    overflow: hidden;
  }

  .cl-shape {
    position: absolute;
    opacity: 0.06;
  }

  .cl-shape-1 {
    width: 250px;
    height: 250px;
    top: -80px;
    right: -60px;
    background: var(--color-text);
    border-radius: 50%;
    animation: cl-float 16s ease-in-out infinite;
  }

  .cl-shape-2 {
    width: 100px;
    height: 100px;
    bottom: 40px;
    left: 5%;
    background: var(--color-text);
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    animation: cl-rotate 22s linear infinite;
  }

  .cl-shape-3 {
    width: 60px;
    height: 60px;
    top: 40%;
    left: 3%;
    border: 6px solid var(--color-text);
    border-radius: 50%;
    background: transparent;
    animation: cl-pulse 10s ease-in-out infinite;
  }

  @keyframes cl-float {
    0%,
    100% {
      transform: translate(0, 0) scale(1);
    }
    50% {
      transform: translate(-25px, 20px) scale(1.05);
    }
  }

  @keyframes cl-rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  @keyframes cl-pulse {
    0%,
    100% {
      transform: scale(1);
      opacity: 0.06;
    }
    50% {
      transform: scale(1.15);
      opacity: 0.1;
    }
  }

  @media (max-width: 767px) {
    .cl-shape-1 {
      width: 150px;
      height: 150px;
    }
    .cl-shape-2 {
      width: 60px;
      height: 60px;
    }
    .cl-shape-3 {
      display: none;
    }
  }

  @media (max-width: 639px) {
    .cl-shape-1 {
      display: none;
    }
    .cl-shape-2 {
      display: none;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .cl-shape,
    .cl-card,
    .cl-card__image,
    .cl-card__arrow {
      animation: none !important;
      transition: none !important;
    }
  }
</style>

{% schema %}
{
  "name": "t:sections.collection_list.name",
  "tag": "section",
  "class": "section section-collection-list",
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "max_blocks": 12,
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.collection_list.settings.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.collection_list.settings.header_content.content"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:sections.collection_list.settings.subheading.label",
      "default": "تصفح مجموعاتنا"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.collection_list.settings.heading.label",
      "default": "المجموعات المميزة"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "t:sections.collection_list.settings.description.label"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "t:sections.collection_list.settings.text_alignment.label",
      "options": [
        {
          "value": "right",
          "label": "t:sections.collection_list.settings.text_alignment.options.right"
        },
        {
          "value": "center",
          "label": "t:sections.collection_list.settings.text_alignment.options.center"
        },
        {
          "value": "left",
          "label": "t:sections.collection_list.settings.text_alignment.options.left"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "t:sections.collection_list.settings.header_layout.content"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "t:sections.collection_list.settings.columns_desktop.label",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "label": "t:sections.collection_list.settings.columns_tablet.label",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "t:sections.collection_list.settings.columns_mobile.label",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "1"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "t:sections.collection_list.settings.image_ratio.label",
      "options": [
        {
          "value": "portrait",
          "label": "t:sections.collection_list.settings.image_ratio.options.portrait"
        },
        {
          "value": "square",
          "label": "t:sections.collection_list.settings.image_ratio.options.square"
        },
        {
          "value": "landscape",
          "label": "t:sections.collection_list.settings.image_ratio.options.landscape"
        },
        {
          "value": "wide",
          "label": "t:sections.collection_list.settings.image_ratio.options.wide"
        }
      ],
      "default": "portrait"
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "t:sections.collection_list.settings.card_style.label",
      "options": [
        {
          "value": "overlay",
          "label": "t:sections.collection_list.settings.card_style.options.overlay"
        },
        {
          "value": "below",
          "label": "t:sections.collection_list.settings.card_style.options.below"
        },
        {
          "value": "minimal",
          "label": "t:sections.collection_list.settings.card_style.options.minimal"
        }
      ],
      "default": "overlay"
    },
    {
      "type": "select",
      "id": "hover_effect",
      "label": "t:sections.collection_list.settings.hover_effect.label",
      "options": [
        {
          "value": "zoom",
          "label": "t:sections.collection_list.settings.hover_effect.options.zoom"
        },
        {
          "value": "rotate",
          "label": "t:sections.collection_list.settings.hover_effect.options.rotate"
        },
        {
          "value": "brighten",
          "label": "t:sections.collection_list.settings.hover_effect.options.brighten"
        }
      ],
      "default": "zoom"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "t:sections.collection_list.settings.overlay_opacity.label",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 40,
      "unit": "%"
    },
    {
      "type": "range",
      "id": "corner_radius",
      "label": "t:sections.collection_list.settings.corner_radius.label",
      "min": 0,
      "max": 32,
      "step": 2,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "show_count",
      "label": "t:sections.collection_list.settings.show_count.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "t:sections.collection_list.settings.show_view_all.label",
      "default": true
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "t:sections.collection_list.settings.view_all_link.label"
    },
    {
      "type": "header",
      "content": "t:sections.collection_list.settings.header_style.content"
    },
    {
      "type": "select",
      "id": "heading_weight",
      "label": "t:sections.collection_list.settings.heading_weight.label",
      "options": [
        {
          "value": "400",
          "label": "t:sections.collection_list.settings.heading_weight.options.400"
        },
        {
          "value": "500",
          "label": "t:sections.collection_list.settings.heading_weight.options.500"
        },
        {
          "value": "600",
          "label": "t:sections.collection_list.settings.heading_weight.options.600"
        },
        {
          "value": "700",
          "label": "t:sections.collection_list.settings.heading_weight.options.700"
        },
        {
          "value": "800",
          "label": "t:sections.collection_list.settings.heading_weight.options.800"
        }
      ],
      "default": "700"
    },
    {
      "type": "checkbox",
      "id": "show_shapes",
      "label": "t:sections.collection_list.settings.show_shapes.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.collection_list.settings.header_spacing.content"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.collection_list.settings.padding_top.label",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.collection_list.settings.padding_bottom.label",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "t:sections.collection_list.blocks.collection.name",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "t:sections.collection_list.blocks.collection.settings.collection.label"
        },
        {
          "type": "image_picker",
          "id": "custom_image",
          "label": "t:sections.collection_list.blocks.collection.settings.custom_image.label",
          "info": "t:sections.collection_list.blocks.collection.settings.custom_image.info"
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "t:sections.collection_list.blocks.collection.settings.custom_title.label",
          "info": "t:sections.collection_list.blocks.collection.settings.custom_title.info"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.collection_list.name",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ],
      "settings": {
        "subheading": "تصفح مجموعاتنا",
        "heading": "المجموعات المميزة"
      }
    }
  ]
}
{% endschema %}
